// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  id         Int         @id @default(autoincrement())
  name       String      @unique @db.VarChar(50)
  email      String      @unique @db.VarChar(100)
  password   String      @db.VarChar(255)
  role       UserRole    @default(user)
  status     UserStatus  @default(active)
  score      Int         @default(100)
  createdAt  DateTime    @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  bookmarks      Bookmark[]
  notes          Note[]
  flashcardSets  FlashcardSet[]
  reports        Report[]
  testimonials   Testimonial[]

  @@map("users")
}

model Bookmark {
  id               Int          @id @default(autoincrement())
  userId           Int          @map("user_id")
  noteId           Int?         @map("note_id")
  flashcardSetId   Int?         @map("flashcard_set_id")
  contentType      ContentType  @map("content_type")
  category         String?      @db.VarChar(100)
  createdAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  note          Note?         @relation(fields: [noteId], references: [id], onDelete: Cascade)
  flashcardSet  FlashcardSet? @relation(fields: [flashcardSetId], references: [id], onDelete: Cascade)

  @@map("bookmarks")
}

model Contact {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(100)
  email      String    @db.VarChar(150)
  content    String    @db.Text
  createdAt  DateTime  @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  @@map("contacts")
}

model FlashcardSet {
  id            Int             @id @default(autoincrement())
  userId        Int             @map("user_id")
  title         String          @default("Untitled") @db.VarChar(150)
  description   String?         @db.Text
  flashcards    Json
  likes         Int             @default(0)
  visibility    Visibility      @default(private)
  category      ContentCategory @default(other)
  createdAt     DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  updatedAt     DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")) @map("updated_at")

  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  reports     Report[]
  bookmarks   Bookmark[]

  @@map("flashcard_set")
}

model Note {
  id          Int             @id @default(autoincrement())
  userId      Int             @map("user_id")
  title       String          @default("Untitled") @db.VarChar(150)
  description String?         @db.Text
  content     Json
  likes       Int             @default(0)
  visibility  Visibility      @default(private)
  category    ContentCategory @default(other)
  createdAt   DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  updatedAt   DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")) @map("updated_at")

  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  reports     Report[]
  bookmarks   Bookmark[]

  @@map("notes")
}

model Report {
  id               Int          @id @default(autoincrement())
  userId           Int          @map("user_id")
  noteId           Int?         @map("note_id")
  flashcardSetId   Int?         @map("flashcard_set_id")
  contentType      ContentType  @map("content_type")
  reason           ReportReason 
  description      String?      @db.VarChar(100)
  status           ReportStatus @default(pending)
  createdAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  note         Note?         @relation(fields: [noteId], references: [id], onDelete: Cascade)
  flashcardSet FlashcardSet? @relation(fields: [flashcardSetId], references: [id], onDelete: Cascade)

  @@map("reports")
}

model Testimonial {
  id         Int      @id @default(autoincrement())
  userId     Int      @map("user_id")
  content    String   @db.Text
  createdAt  DateTime @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  user      User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("testimonials")
}

enum Visibility {
  public
  private
}

enum ContentType {
  note
  flashcard
}

enum UserRole {
  user
  admin
}

enum UserStatus {
  active
  suspended
  banned
}

enum ReportStatus {
  pending
  reviewed
  resolved
  rejected
}

enum ReportReason {
  inappropriate_content
  incorrect_information
  misleading_explanation
  plagiarism
  spam
  other
}

enum ContentCategory {
  mathematics
  science
  language
  social_science
  computer_science
  business_economics
  engineering
  arts_humanities
  health_medicine
  test_preparation
  other
}