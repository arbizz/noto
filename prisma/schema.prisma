// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  id             Int         @id @default(autoincrement())
  name           String?     @db.VarChar(50)
  email          String      @unique @db.VarChar(100)
  emailVerified  DateTime?
  image          String?
  role           UserRole    @default(user)
  status         UserStatus  @default(active)
  suspendedUntil DateTime?   @map("suspended_until")
  score          Int         @default(100)
  createdAt      DateTime    @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  updatedAt      DateTime    @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")) @map("updated_at")

  accounts       Account[]
  bookmarks      Bookmark[]
  contents       Content[]
  reports        Report[]
  likes          Like[]
  notifications  Notification[]
  followers      Follow[] @relation("Following")
  following      Follow[] @relation("Followers")

  @@map("users")
}

model Account {
  id                 Int      @id @default(autoincrement())
  userId             Int      @map("user_id")
  type               String
  provider           String
  providerAccountId  String   @map("provider_account_id")

  refresh_token      String?  @db.Text
  access_token       String?  @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?  @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Content {
  id            Int             @id @default(autoincrement())
  userId        Int             @map("user_id")
  contentType   ContentType     @map("content_type")
  title         String          @default("Untitled") @db.VarChar(150)
  description   String?         @db.Text
  content       Json            // For note content or flashcards array
  visibility    Visibility      @default(private)
  category      ContentCategory @default(other)
  createdAt     DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  updatedAt     DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")) @map("updated_at")

  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  reports     Report[]
  bookmarks   Bookmark[]
  likes       Like[]

  @@index([userId, contentType])
  @@index([visibility, category])
  @@map("contents")
}

model Bookmark {
  id               Int          @id @default(autoincrement())
  userId           Int          @map("user_id")
  contentId        Int          @map("content_id")
  contentType      ContentType  @map("content_type")
  category         String?      @db.VarChar(100)
  createdAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  content  Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([userId, contentId])
  @@map("bookmarks")
}

model Contact {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(100)
  email      String    @db.VarChar(150)
  content    String    @db.Text
  createdAt  DateTime  @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  @@map("contacts")
}

model Like {
  id               Int          @id @default(autoincrement())
  userId           Int          @map("user_id")
  contentId        Int          @map("content_id")
  contentType      ContentType  @map("content_type")
  createdAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  content  Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([userId, contentId])
  @@map("likes")
}

model Report {
  id               Int          @id @default(autoincrement())
  userId           Int          @map("user_id")
  contentId        Int          @map("content_id")
  contentType      ContentType  @map("content_type")
  reason           ReportReason
  description      String?      @db.VarChar(100)
  status           ReportStatus @default(pending)
  createdAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  updatedAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")) @map("updated_at")

  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  content  Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@map("reports")
}

model Notification {
  id          Int              @id @default(autoincrement())
  userId      Int              @map("user_id")
  type        NotificationType
  title       String           @db.VarChar(150)
  message     String           @db.VarChar(255)
  link        String?          @db.VarChar(255)
  isRead      Boolean          @default(false) @map("is_read")
  createdAt   DateTime         @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Follow {
  id          Int      @id @default(autoincrement())
  followerId  Int      @map("follower_id")
  followingId Int      @map("following_id")
  createdAt   DateTime @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  follower  User @relation("Followers", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@map("follows")
}

// Enums
enum Visibility {
  public
  private
}

enum ContentType {
  note
  flashcard
}

enum UserRole {
  user
  admin
}

enum UserStatus {
  active
  suspended
  banned
}

enum ReportStatus {
  pending
  reviewed
  resolved
  rejected
}

enum ReportReason {
  inappropriate_content
  incorrect_information
  misleading_explanation
  plagiarism
  spam
  other
}

enum ContentCategory {
  mathematics
  science
  language
  social_science
  computer_science
  business_economics
  engineering
  arts_humanities
  health_medicine
  test_preparation
  other
}

enum NotificationType {
  report_reviewed
  report_resolved
  content_deleted
  score_reduced
  new_follower
}