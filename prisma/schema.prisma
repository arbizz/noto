// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  id            Int         @id @default(autoincrement())
  name          String      @db.VarChar(50)
  email         String      @unique @db.VarChar(100)
  emailVerified DateTime?
  password      String?     @db.VarChar(255) // Optional for OAuth users
  image         String?
  role          UserRole    @default(user)
  status        UserStatus  @default(active)
  score         Int         @default(100)
  createdAt     DateTime    @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  updatedAt     DateTime    @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")) @map("updated_at")

  accounts       Account[]
  bookmarks      Bookmark[]
  notes          Note[]
  flashcardSets  FlashcardSet[]
  reports        Report[]
  likes          Like[]

  @@map("users")
}

model Account {
  id                 Int      @id @default(autoincrement())
  userId             Int      @map("user_id")
  type               String
  provider           String
  providerAccountId  String   @map("provider_account_id")

  refresh_token      String?  @db.Text
  access_token       String?  @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?  @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Bookmark {
  id               Int          @id @default(autoincrement())
  userId           Int          @map("user_id")
  noteId           Int?         @map("note_id")
  flashcardSetId   Int?         @map("flashcard_set_id")
  contentType      ContentType  @map("content_type")
  category         String?      @db.VarChar(100)
  createdAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  note          Note?         @relation(fields: [noteId], references: [id], onDelete: Cascade)
  flashcardSet  FlashcardSet? @relation(fields: [flashcardSetId], references: [id], onDelete: Cascade)

  @@unique([userId, noteId, flashcardSetId])
  @@map("bookmarks")
}

model Contact {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(100)
  email      String    @db.VarChar(150)
  content    String    @db.Text
  createdAt  DateTime  @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  @@map("contacts")
}

model FlashcardSet {
  id            Int             @id @default(autoincrement())
  userId        Int             @map("user_id")
  title         String          @default("Untitled") @db.VarChar(150)
  description   String?         @db.Text
  flashcards    Json
  visibility    Visibility      @default(private)
  category      ContentCategory @default(other)
  createdAt     DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  updatedAt     DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")) @map("updated_at")

  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  reports     Report[]
  bookmarks   Bookmark[]
  likes       Like[]

  @@map("flashcard_set")
}

model Note {
  id          Int             @id @default(autoincrement())
  userId      Int             @map("user_id")
  title       String          @default("Untitled") @db.VarChar(150)
  description String?         @db.Text
  content     Json
  visibility  Visibility      @default(private)
  category    ContentCategory @default(other)
  createdAt   DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  updatedAt   DateTime        @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")) @map("updated_at")

  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  reports     Report[]
  bookmarks   Bookmark[]
  likes       Like[]

  @@map("notes")
}

model Like {
  id               Int          @id @default(autoincrement())
  userId           Int          @map("user_id")
  noteId           Int?         @map("note_id")
  flashcardSetId   Int?         @map("flashcard_set_id")
  contentType      ContentType  @map("content_type")
  createdAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")

  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  note          Note?         @relation(fields: [noteId], references: [id], onDelete: Cascade)
  flashcardSet  FlashcardSet? @relation(fields: [flashcardSetId], references: [id], onDelete: Cascade)

  @@unique([userId, noteId, flashcardSetId])
  @@map("likes")
}

model Report {
  id               Int          @id @default(autoincrement())
  userId           Int          @map("user_id")
  noteId           Int?         @map("note_id")
  flashcardSetId   Int?         @map("flashcard_set_id")
  contentType      ContentType  @map("content_type")
  reason           ReportReason
  description      String?      @db.VarChar(100)
  status           ReportStatus @default(pending)
  createdAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP")) @map("created_at")
  updatedAt        DateTime     @db.Timestamp(0) @default(dbgenerated("CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP")) @map("updated_at")

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  note         Note?         @relation(fields: [noteId], references: [id], onDelete: Cascade)
  flashcardSet FlashcardSet? @relation(fields: [flashcardSetId], references: [id], onDelete: Cascade)

  @@map("reports")
}

// Enums
enum Visibility {
  public
  private
}

enum ContentType {
  note
  flashcard
}

enum UserRole {
  user
  admin
}

enum UserStatus {
  active
  suspended
  banned
}

enum ReportStatus {
  pending
  reviewed
  resolved
  rejected
}

enum ReportReason {
  inappropriate_content
  incorrect_information
  misleading_explanation
  plagiarism
  spam
  other
}

enum ContentCategory {
  mathematics
  science
  language
  social_science
  computer_science
  business_economics
  engineering
  arts_humanities
  health_medicine
  test_preparation
  other
}